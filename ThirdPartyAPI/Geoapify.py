#Geoapify for reverse Geocoding from address to latlong
import json
import urllib.parse

import requests
import bs4


#lat=12.900481145392233, long=77.64630954000579


url = "https://www.justdial.com/Bangalore/AC-Repair-&-Services/nct-10890481"
cookies = 'ppc=; ppc=; _ctok=c6a64a13befa317134105784833g3nF4EFnjmy33mECjCqmFBvxxA4oh5o3kz9; web_visit=2024-04-18T03:22:58.483Z; jd_www_nxt=1; _ga=GA1.1.1380805770.1713410579; jdeflg=0; JDSID=QXAsaNSyMmDwFK3FG2GG6BnsU6uJxWcI74wEdhdrvwU%253D; sid=QXAsaNSyMmDwFK3FG2GG6BnsU6uJxWcI74wEdhdrvwU%253D; new_user=0; userProfile=%7B%22name%22%3A%22Ashish+Bajpai%22%2C%22mobile%22%3A%229900142473%22%2C%22photo%22%3A%22https%3A%5C%2F%5C%2Fprofile.justdial.com%5C%2FprofileImg%3Fpi%3DUozHELk9xZOHieKxvTNqud2zvNpkObhgzKtOE7q3LJY%253D%22%2C%22email%22%3A%22ashishbaj%40gmail.com%22%2C%22dob%22%3A%22%22%2C%22gender%22%3A%220%22%2C%22status%22%3A%22true%22%7D; jde=0; jdvn=0; scity=Bangalore; inweb_city=Bangalore; userpin=560102; usrcity=Bangalore; userarea=Yellukunte; slat=12.900; slon=77.646; MP_city=Bangalore; MP_area=HSR Layout; MP_pincode=560102; MP_lat=12.910749435424805; MP_long=77.64115142822266; Continent=AS; Ak_City=BANGALORE; JDTID=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE3MTU2NzMxOTQsImp0aSI6Ik1USXlMakUzTVM0eU1TNHlNRGNzSURFd05DNDNOeTR4TnpNdU5EUXNJREl6TGpZMUxqRXlOQzQzTkN3Z01qTXVOalV1TVRJMExqYzBYME5vY205dFpWOXRZV009IiwiaXNzIjoid3d3Lmp1c3RkaWFsLmNvbSIsIm5iZiI6MTcxNTY3MzE5NCwiZXhwIjoxNzE1NzU5NTk0LCJkYXRhIjp7ImpkZWZsZyI6IjAifX0.R3kBhxs0xH_Wpi5mrohUeG4RIFIYqzh7sp6LskWfETc; ppc=; AKA_A2=A; bm_ss=ab8e18ef4e; main_city=Bangalore; pincode=; ak_bmsc=62F214420BDB4A6225FC2F7CEAD9E35A~000000000000000000000000000000~YAAQTa1NaPjc6VCPAQAA8WQXdhemSqXL8k5ILfCShaARiap/Gfg1UOo6YOD/FGjY6aeRnuNs4OSSfz5G+zB4aOJcdNLqgK08cDkpUyUQEx9r/yHoZJvHGBeRzVDrcs1fS2z/Dt9gl+MGIFPD5A23HWfa9TGujB2sNjQYwjsJPnBoQB0piunqwZA8fFbxXbeP1zy2qYdhPxgJoGIHPqkuGfYtU2a76M0P5A4QGagkwnDuzw86ZQ3wZUDx1VG2GjGXs5VYny2WItwZSHof1Yz+tncDuDUN0b5x9CyfvEBGv85RyMmAD8qAcanm6B4hc4VE0ZF3e0/V4yldaTcw3eVJXfDWgrjZ79tBXqluErNeL3SP7EhBBoA9yCwGuVskYB5WWTsSh0jlOF0B1qctf0tSG24teDpopxc5z5cDhrKHCl3CIvDbj+qwVh0mUvL4sZzADdzGyF5aeo1d; TKY=6339b4ff30ddccfd3daf9d3468963fbfaab79fbe1b47949f7f496c2463c14966; attn_user=login; soid=ASHISH-Bajpai-4q2Volej2XQZyejNmGQB; docidarray=; PHPSESSID=d9c2b621ea76c2b1b843105fa44ac3cd; akcty=Bangalore; alat=; alon=; sarea=; rfr=gen; lpg=lst; _abck=D384487BCC6320B765C9B58727DD1326~0~YAAQLa1NaORUHFGPAQAAgGscdgs3Z3fLr+97Ci6OW2KY/8iTjocMQ/j6U+0qoT+HwsGtyO/r+OrMMz/d9HZo0Z1WCQYAHGbCVc7reAWk91GbTmoVB3Bl2TDOrHvhP3gNZDGj3mqkaUAzSAXZp+KRcJ+TptEl9q5FxEdjPKLvcjgxJzm3EzU/U1VTlVD2LQwfyiDzXnIhdIP93rTn2dwlcnTsWHT4NXXQ23ezLUoZygZUYbVRmyjLbKjG8WVMwB2XrLgjsKMl0Y79OmWFUnmikQb3EAPUJJxGfYAJRvtV/VZnXBY1w9UqGoApfN0VhmM4zU7xnSw58DrgF093IMxw3+IyrKMJ1B7TBLBtmsYhqr1KonRU4EdbGC21vM266kyVkgKQ2m39DL9GMAsUTMjscA08I5okB3oTdZx5w8MjE2fGnuPxBjfyZpl27axx2iI29ZfRyBMt~-1~-1~1715676795; __gads=ID=39749980d4816f86:T=1713410782:RT=1715673624:S=ALNI_MZYOCBybj_D7ekBVI4-vaJpePKvwQ; __gpi=UID=00000df0a1e58903:T=1713410782:RT=1715673624:S=ALNI_MY_ONs2vCNhJlGY6WAAE5G9T7VYgA; __eoi=ID=7ef7d6a348fab7dd:T=1713410782:RT=1715673624:S=AA-AfjZCbEBabE37MjEab1JzMr59; bm_s=YAAQX61NaOhP3zKPAQAAKyMedgFIv/7w7YWjzALOXquBwE3pSNtsoQtlfDmNUsAhrPKNX8dKVn/NsrKLyM5YnXqjuTtvEvQH+65QX9OiVCRT2rPH0LaB89uQssSHKEWC8tNwe9W6SY1flVM5xLBUeUwUZoYrmXY0LKVGo7ux0jhcCyuUKKFut74/NqiZ8gV3H/EdcJg+fG6PU4mRZkM031cmeZSo0UgloGyxillU/VcT0gXZgoKGZL3pUrLjfI6IrtHlDG0+k7E+D1XR/26qtaneTh9Rvj7dwk2A5vRzARprKtF00VHA08c0KKbhndw94COh1imhXjNkWW/iwCcE9orzig5K4cKFjzhX2NcrsQswcHoabMZOur/kKpHTsAwglPFPraEPxjVbQbpmsaig6U5jGaxA3NwSq4g=; bm_sz=82146B60D75AE8C5FF8FAC9AB0FC0EB9~YAAQX61NaOpP3zKPAQAAKyMedhdxlomwnOaZNNHz2uh5BSu1M4dazCAqtWXiXMCvAIgmGca3oOpmRFyFTPK/bZ+7MmNZdeurES1kDPBr/rMjzQr5Jv87YqFv0THspQc0c4XEh3QZ9e6ajcUOh96sb97///JSPIV3kEnnhGbqIs7WDdo8Okdya6y33emCooc7Jq8JpR5Wo7SN2TUhU5HFCnY3gc2lb0KWiAsBNhP3EJ0XUSpH2dwsokC/Wo1p7CrQNyooeDM6Wg9ojKsEBmUyv6PTmsnP5hMQiB0p7+gNL6N/SvWtCZhtTkMQnb2dRQ7bhfO0Ff+AWvXt3oI9fsHv7rqx6zpd3FuKDiYMG+C0qSAhjjpptfiluhjjO05QpVa5h5CV1l/vXKzNHH3qaKbZBJTnoS2txxm5JjZ8QwiasYMgIGfxML6ZirXpe5UxK4E=~4605237~3224880; _ga_5PY4KYQRFS=GS1.1.1715673195.5.1.1715673638.44.0.0; FCNEC=%5B%5B%22AKsRol_3wU-YYf8QN3c3tSU_quZgzLTBpGklkFSFp4h-63fXUdQwV85mFycplt7FAD6vybKPRTrtB92S-p_kABq1aJw69XsCWjiykz8i2qagS1Lu4z810PnC_oat0dG1b1kYj8MpKl1X3QZR8rMc2k9IyK6pmHnn0g%3D%3D%22%5D%5D; bm_sv=72F635612E59A2CED6C3FE8F99DEDF8D~YAAQX61NaAlu3zKPAQAA4bIfdhes3XqY01FWt+0XL8/u1Dr2qbH8ZKxnvPxvN4AKLsvIQwKukgsThBcnzQOf9eB0VornjrVpcTLP1s/rQn9lN6u0YCVZBuEW9Br12CrRtQI5Ioj9xWGhdm5NEE5lJULa0Up3CzV+DqboTqEYACr5paR85YSB23WE8N6iNy16ywTn/2BH/M/MbI6pg3pr6SGbtq+pfRW126+OMjUfqqRtB6wkM3HwT5+OhhwcvxdFCa6i~1; RT="z=1&dm=justdial.com&si=cfa6e720-ea5d-40bf-b45d-ade2169d3b3e&ss=lw63iszj&sl=4&tt=1gd&obo=3&rl=1&ld=14koe&r=dj4et12&ul=14kof"'
headers = {'Accept':'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7'}
headers['Accept-Encoding'] = 'gzip, deflate, br, zstd'
headers['Accept-Language'] = 'en-GB,en-US;q=0.9,en;q=0.8'



def createstore(inputstring):
    store ={}
    splitted = inputstring.split(';')
    for attribute in splitted:
        kv = attribute.split("=")
        store[kv[0]] = kv[1]
    return store

cookiestore = createstore(cookies)
#print(cookiestore)

response = requests.get(url=url, cookies=cookiestore, headers=headers)

#print(response)

#Geoapify API for reverse geocoding and geocoding

from requests.structures import CaseInsensitiveDict

param = {"text":"Purvi Lotus, Hosapalya Main Road, Bommanahalli post, bangalore, karnataka, india, 560068", "apiKey":"34f2cec8cb774aa39efcbff3f1845171"}
#url1 = "https://api.geoapify.com/v1/geocode/search?text=38%20Upper%20Montagu%20Street%2C%20Westminster%20W1H%201LJ%2C%20United%20Kingdom&apiKey=34f2cec8cb774aa39efcbff3f1845171"
url_geocoding = 'https://api.geoapify.com/v1/geocode/search?text=Purvi Lotus Hosapalya Main Road Bommanahalli post bngalore 560068&apiKey=34f2cec8cb774aa39efcbff3f1845171'
url_reversegeocoding = 'https://api.geoapify.com/v1/geocode/reverse?lat=12.9002787&lon=77.6463461&apiKey=34f2cec8cb774aa39efcbff3f1845171'
response_geocoding = '{"type":"FeatureCollection","features":[{"type":"Feature","geometry":{"type":"Point","coordinates":[-0.160493,51.520125]},"properties":{"country_code":"gb","street":"Upper Montagu Street","country":"United Kingdom","county":"London","datasource":{"sourcename":"openstreetmap","attribution":"\xc2\xa9 OpenStreetMap contributors","license":"Open Database License","url":"https://www.openstreetmap.org/copyright"},"state":"England","city":"London","district":"Westminster","suburb":"Marylebone","state_code":"ENG","lon":-0.160493,"lat":51.520125,"result_type":"street","postcode":"W1H 1SJ","formatted":"Upper Montagu Street, London, W1H 1SJ, United Kingdom","address_line1":"Upper Montagu Street","address_line2":"London, W1H 1SJ, United Kingdom","timezone":{"name":"Europe/London","offset_STD":"+00:00","offset_STD_seconds":0,"offset_DST":"+01:00","offset_DST_seconds":3600,"abbreviation_STD":"GMT","abbreviation_DST":"BST"},"plus_code":"9C3XGRCQ+3R","plus_code_short":"GRCQ+3R London, United Kingdom","rank":{"popularity":8.988490181891963,"confidence":1,"confidence_city_level":0,"confidence_street_level":0,"match_type":"full_match"},"place_id":"51a8531edd088bc4bf597f6abc7493c24940c00204e203256f70656e7374726565746d61703a7374726565743a706f6c796c696e653a33393536303438"},"bbox":[-0.161075,51.518836,-0.159925,51.521411]},{"type":"Feature","properties":{"datasource":{"sourcename":"openstreetmap","attribution":"\xc2\xa9 OpenStreetMap contributors","license":"Open Database License","url":"https://www.openstreetmap.org/copyright"},"country":"United Kingdom","country_code":"gb","state":"England","county":"Greater London","city":"London","postcode":"W1H 2HZ","suburb":"Marylebone","street":"Upper Montagu Street","housenumber":"7","lon":-0.16024185488235232,"lat":51.519168,"state_code":"ENG","district":"Westminster","result_type":"building","formatted":"7 Upper Montagu Street, London, W1H 2HZ, United Kingdom","address_line1":"7 Upper Montagu Street","address_line2":"London, W1H 2HZ, United Kingdom","category":"building.residential","timezone":{"name":"Europe/London","offset_STD":"+00:00","offset_STD_seconds":0,"offset_DST":"+01:00","offset_DST_seconds":3600,"abbreviation_STD":"GMT","abbreviation_DST":"BST"},"plus_code":"9C3XGR9Q+MW","plus_code_short":"GR9Q+MW London, Greater London, United Kingdom","rank":{"importance":0.00000999999999995449,"popularity":8.9183000560961,"confidence":1,"confidence_city_level":0,"confidence_street_level":0,"match_type":"inner_part"},"place_id":"5138c5151bce82c4bf599b90d61874c24940f00102f901dba60f0c00000000c00203e203236f70656e7374726565746d61703a616464726573733a7761792f323032333532333437"},"geometry":{"type":"Point","coordinates":[-0.16024185488235232,51.519168]},"bbox":[-0.1603685,51.5191244,-0.1601687,51.5191998]},{"type":"Feature","properties":{"datasource":{"sourcename":"openstreetmap","attribution":"\xc2\xa9 OpenStreetMap contributors","license":"Open Database License","url":"https://www.openstreetmap.org/copyright"},"country":"United Kingdom","country_code":"gb","state":"England","county":"Greater London","city":"London","postcode":"W1H 2HZ","suburb":"Marylebone","street":"Upper Montagu Street","housenumber":"16","lon":-0.15992842519161116,"lat":51.5194132,"state_code":"ENG","district":"Westminster","result_type":"building","formatted":"16 Upper Montagu Street, London, W1H 2HZ, United Kingdom","address_line1":"16 Upper Montagu Street","address_line2":"London, W1H 2HZ, United Kingdom","category":"building.residential","timezone":{"name":"Europe/London","offset_STD":"+00:00","offset_STD_seconds":0,"offset_DST":"+01:00","offset_DST_seconds":3600,"abbreviation_STD":"GMT","abbreviation_DST":"BST"},"plus_code":"9C3XGR9R+Q2","plus_code_short":"GR9R+Q2 London, Greater London, United Kingdom","rank":{"importance":0.00000999999999995449,"popularity":8.9183000560961,"confidence":1,"confidence_city_level":0,"confidence_street_level":0,"match_type":"inner_part"},"place_id":"51520af3dd8878c4bf592c8eb9217cc24940f00102f9014feb7e2800000000c00203e203236f70656e7374726565746d61703a616464726573733a7761792f363739343036343135"},"geometry":{"type":"Point","coordinates":[-0.15992842519161116,51.5194132]},"bbox":[-0.1600454,51.5193666,-0.1598115,51.519458]},{"type":"Feature","properties":{"datasource":{"sourcename":"openstreetmap","attribution":"\xc2\xa9 OpenStreetMap contributors","license":"Open Database License","url":"https://www.openstreetmap.org/copyright"},"country":"United Kingdom","country_code":"gb","state":"England","county":"Greater London","city":"London","postcode":"W1H 2HZ","suburb":"Marylebone","street":"Upper Montagu Street","housenumber":"8","lon":-0.15987389028860877,"lat":51.51918645000001,"state_code":"ENG","district":"Westminster","result_type":"building","formatted":"8 Upper Montagu Street, London, W1H 2HZ, United Kingdom","address_line1":"8 Upper Montagu Street","address_line2":"London, W1H 2HZ, United Kingdom","category":"building.residential","timezone":{"name":"Europe/London","offset_STD":"+00:00","offset_STD_seconds":0,"offset_DST":"+01:00","offset_DST_seconds":3600,"abbreviation_STD":"GMT","abbreviation_DST":"BST"},"plus_code":"9C3XGR9R+M3","plus_code_short":"GR9R+M3 London, Greater London, United Kingdom","rank":{"importance":0.00000999999999995449,"popularity":8.9183000560961,"confidence":1,"confidence_city_level":0,"confidence_street_level":0,"match_type":"inner_part"},"place_id":"51100e2365bf76c4bf5960a39bb374c24940f00102f9015eeb7e2800000000c00203e203236f70656e7374726565746d61703a616464726573733a7761792f363739343036343330"},"geometry":{"type":"Point","coordinates":[-0.15987389028860877,51.51918645000001]},"bbox":[-0.1599384,51.5191425,-0.159702,51.5192281]},{"type":"Feature","properties":{"datasource":{"sourcename":"openstreetmap","attribution":"\xc2\xa9 OpenStreetMap contributors","license":"Open Database License","url":"https://www.openstreetmap.org/copyright"},"country":"United Kingdom","country_code":"gb","state":"England","county":"Greater London","city":"London","postcode":"W1H 2HZ","suburb":"Marylebone","street":"Upper Montagu Street","housenumber":"20","lon":-0.16002603526052953,"lat":51.5194967,"state_code":"ENG","district":"Westminster","result_type":"building","formatted":"20 Upper Montagu Street, London, W1H 2HZ, United Kingdom","address_line1":"20 Upper Montagu Street","address_line2":"London, W1H 2HZ, United Kingdom","category":"building.residential","timezone":{"name":"Europe/London","offset_STD":"+00:00","offset_STD_seconds":0,"offset_DST":"+01:00","offset_DST_seconds":3600,"abbreviation_STD":"GMT","abbreviation_DST":"BST"},"plus_code":"9C3XGR9Q+QX","plus_code_short":"GR9Q+QX London, Greater London, United Kingdom","rank":{"importance":0.00000999999999995449,"popularity":8.9183000560961,"confidence":1,"confidence_city_level":0,"confidence_street_level":0,"match_type":"inner_part"},"place_id":"5115ecf9adbb7bc4bf59a1702cde7ec24940f00102f9013beb7e2800000000c00203e203236f70656e7374726565746d61703a616464726573733a7761792f363739343036333935"},"geometry":{"type":"Point","coordinates":[-0.16002603526052953,51.5194967]},"bbox":[-0.1600942,51.5194778,-0.1598647,51.5195424]}],"query":{"text":"Upper Montagu street Westminster W1H United kingdom","parsed":{"street":"upper montagu street","district":"westminster","city":"w1h","country":"united kingdom","expected_type":"street"}}}'

print(urllib.parse.urlencode(param))
urlhead = f'https://api.geoapify.com/v1/geocode/search?{urllib.parse.urlencode(param)}'
headers = CaseInsensitiveDict()
headers["Accept"] = "application/json"
resp = requests.get(url_reversegeocoding, headers=headers)
#print(resp.content)
#12.88511,77.49688
#12.970541, 77.604785
resp_geocoding = requests.get(urlhead, headers=headers)
print(resp_geocoding.content)




#Openstreet Maps API
#lat=12.900481145392233, long=77.64630954000579
paramstore = {"lat":"12.900481145392233", "long":"77.64630954000579"}
key="4a81d1d4dd324cde92e1c66fd1e5a0d4"
osm_url_geocoding = f'https://api.opencagedata.com/geocode/v1/json?key={key}&q={paramstore["lat"]}%2C+{paramstore["long"]}'

response = requests.get(osm_url_geocoding)
#print(response.content)
print(json.loads(response.content))

